CREATE TABLE "balances" ("id" uuid NOT NULL, "total_amount" double precision NOT NULL, "available_amount" double precision NOT NULL, "entity_id" uuid NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, PRIMARY KEY ("id"));
CREATE UNIQUE INDEX "balances_entity_id_key" ON "balances" ("entity_id");
CREATE TABLE "ledgers" ("id" uuid NOT NULL, "status" character varying NOT NULL DEFAULT 'pending', "invoice_id" uuid NOT NULL, "entity" character varying NOT NULL, "entity_id" uuid NOT NULL, "amount" double precision NOT NULL, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, PRIMARY KEY ("id"));
CREATE TABLE "investors" ("id" uuid NOT NULL, "name" character varying NOT NULL, "joined_at" timestamptz NOT NULL, "investor_balance" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "investors_balances_balance" FOREIGN KEY ("investor_balance") REFERENCES "balances" ("id") ON DELETE NO ACTION);
CREATE TABLE "issuers" ("id" uuid NOT NULL, "name" character varying NOT NULL, "joined_at" timestamptz NOT NULL, "issuer_balance" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "issuers_balances_balance" FOREIGN KEY ("issuer_balance") REFERENCES "balances" ("id") ON DELETE NO ACTION);
CREATE TABLE "invoices" ("id" uuid NOT NULL, "status" character varying NOT NULL DEFAULT 'pending', "asking_price" double precision NOT NULL DEFAULT 0, "is_locked" boolean NOT NULL DEFAULT false, "is_approved" boolean NOT NULL DEFAULT false, "invoice_number" character varying NOT NULL, "invoice_date" timestamptz NOT NULL, "due_date" timestamptz NOT NULL, "amount_due" double precision NOT NULL, "customer_name" character varying NOT NULL, "reference" character varying NULL, "company_name" character varying NULL, "currency" character varying NOT NULL DEFAULT 'GBP', "total_amount" double precision NULL DEFAULT 0, "total_vat" double precision NULL DEFAULT 0, "created_at" timestamptz NOT NULL, "issuer_invoices" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "invoices_issuers_invoices" FOREIGN KEY ("issuer_invoices") REFERENCES "issuers" ("id") ON DELETE NO ACTION);
CREATE TABLE "bids" ("id" uuid NOT NULL, "status" character varying NOT NULL DEFAULT 'PENDING', "amount" double precision NOT NULL, "accepted_amount" double precision NOT NULL DEFAULT 0, "created_at" timestamptz NOT NULL, "updated_at" timestamptz NOT NULL, "investor_bids" uuid NOT NULL, "invoice_bids" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "bids_investors_bids" FOREIGN KEY ("investor_bids") REFERENCES "investors" ("id") ON DELETE NO ACTION, CONSTRAINT "bids_invoices_bids" FOREIGN KEY ("invoice_bids") REFERENCES "invoices" ("id") ON DELETE NO ACTION);
CREATE TABLE "invoice_items" ("id" uuid NOT NULL, "description" character varying NOT NULL, "quantity" bigint NOT NULL, "unit_price" double precision NOT NULL, "amount" double precision NOT NULL, "vat_rate" double precision NOT NULL DEFAULT 0, "vat_amount" double precision NOT NULL DEFAULT 0, "invoice_items" uuid NULL, PRIMARY KEY ("id"), CONSTRAINT "invoice_items_invoices_items" FOREIGN KEY ("invoice_items") REFERENCES "invoices" ("id") ON DELETE SET NULL);
CREATE TABLE "investor_invoices" ("investor_id" uuid NOT NULL, "invoice_id" uuid NOT NULL, PRIMARY KEY ("investor_id", "invoice_id"), CONSTRAINT "investor_invoices_investor_id" FOREIGN KEY ("investor_id") REFERENCES "investors" ("id") ON DELETE CASCADE, CONSTRAINT "investor_invoices_invoice_id" FOREIGN KEY ("invoice_id") REFERENCES "invoices" ("id") ON DELETE CASCADE);